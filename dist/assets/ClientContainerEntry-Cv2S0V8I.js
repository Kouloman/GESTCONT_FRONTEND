import{r as o,R as e,L as v,d,j as R,i as F,e as u,m as k}from"./index-wFRW0Cer.js";import{F as D,c as q,a as w,b as r,E as n,d as l,e as L}from"./index.esm-DEY0XWA5.js";import{C as O}from"./check-Cvo7CuuM.js";import"./index-Ch8__LMA.js";const T=q().shape({entryDate:L().max(new Date,"La date ne peut pas être dans le futur").required("La date d'entrée est requise"),clientId:l().required("Le client est requis"),containerNumber:l().matches(/^[A-Z]{3}U\d{7}$/,"Format invalide. Ex: MSCU1234567").required("Le numéro de conteneur est requis"),isoCodeId:l().required("Le code ISO est requis"),type:l().oneOf(["DRY","REEFER"],"Type invalide").required("Le type de conteneur est requis"),damages:l(),transporter:l().required("Le transporteur est requis"),truckRef:l().required("La référence du camion est requise"),comments:l()}),A=()=>{const[i,E]=o.useState([]),[p,f]=o.useState([]),[C,S]=o.useState(!0),[x,N]=o.useState(!1),[h,b]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const[t,c]=await Promise.all([d.get("/clients"),d.get("/iso-codes")]);E(t.data),f(c.data)}catch{try{const[c,m]=await Promise.all([R.getAll(),F.getAll()]);E(c),f(m)}catch{u.error("Erreur lors du chargement des données")}}finally{S(!1)}})()},[]);const I=async(a,{resetForm:t})=>{var c;N(!0);try{const m={...a,entryDate:new Date(a.entryDate).toISOString(),client:((c=i.find(s=>s.id===a.clientId))==null?void 0:c.name)||a.clientId,source:"CLIENT"},y=i.find(s=>s.id===a.clientId),g=p.find(s=>s.id===a.isoCodeId);y&&(m.clientName=y.name),g&&(m.isoCode=g.code);try{await d.post("/containers/client",m)}catch(s){if(s.isMockable)await k.create(m);else throw s}u.success("Conteneur enregistré avec succès"),b(!0),t(),setTimeout(()=>{b(!1)},3e3)}catch{u.error("Erreur lors de l'enregistrement du conteneur")}finally{N(!1)}};return C?e.createElement(v,null):e.createElement("div",{className:"bg-white rounded-lg shadow-sm p-6 animate-fadeIn"},e.createElement("h2",{className:"text-xl font-semibold text-gray-800 mb-6"},"Enregistrement d'entrée de conteneur par client"),h&&e.createElement("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md text-green-800 flex items-center"},e.createElement(O,{size:20,className:"mr-2"}),e.createElement("span",null,"Conteneur enregistré avec succès!")),e.createElement(D,{initialValues:{entryDate:new Date().toISOString().split("T")[0],clientId:"",containerNumber:"",isoCodeId:"",type:"",damages:"",transporter:"",truckRef:"",comments:""},validationSchema:T,onSubmit:I},({isSubmitting:a})=>e.createElement(w,{className:"space-y-4"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("label",{htmlFor:"entryDate",className:"form-label"},"Date d'entrée"),e.createElement(r,{type:"date",id:"entryDate",name:"entryDate",className:"form-input"}),e.createElement(n,{name:"entryDate",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"clientId",className:"form-label"},"Client"),e.createElement(r,{as:"select",id:"clientId",name:"clientId",className:"form-select"},e.createElement("option",{value:""},"Sélectionner un client"),i.map(t=>e.createElement("option",{key:t.id,value:t.id},t.name))),e.createElement(n,{name:"clientId",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"containerNumber",className:"form-label"},"Numéro de conteneur"),e.createElement(r,{type:"text",id:"containerNumber",name:"containerNumber",placeholder:"Ex: MSCU1234567",className:"form-input uppercase"}),e.createElement(n,{name:"containerNumber",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"isoCodeId",className:"form-label"},"Code ISO"),e.createElement(r,{as:"select",id:"isoCodeId",name:"isoCodeId",className:"form-select"},e.createElement("option",{value:""},"Sélectionner un code ISO"),p.map(t=>e.createElement("option",{key:t.id,value:t.id},t.code," - ",t.description))),e.createElement(n,{name:"isoCodeId",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"type",className:"form-label"},"Type de conteneur"),e.createElement(r,{as:"select",id:"type",name:"type",className:"form-select"},e.createElement("option",{value:""},"Sélectionner un type"),e.createElement("option",{value:"DRY"},"DRY"),e.createElement("option",{value:"REEFER"},"REEFER")),e.createElement(n,{name:"type",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"transporter",className:"form-label"},"Transporteur"),e.createElement(r,{type:"text",id:"transporter",name:"transporter",className:"form-input"}),e.createElement(n,{name:"transporter",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"truckRef",className:"form-label"},"Référence du camion"),e.createElement(r,{type:"text",id:"truckRef",name:"truckRef",className:"form-input"}),e.createElement(n,{name:"truckRef",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"damages",className:"form-label"},"Avaries"),e.createElement(r,{as:"textarea",id:"damages",name:"damages",rows:2,className:"form-input"}),e.createElement(n,{name:"damages",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"comments",className:"form-label"},"Commentaires"),e.createElement(r,{as:"textarea",id:"comments",name:"comments",rows:2,className:"form-input"}),e.createElement(n,{name:"comments",component:"div",className:"text-red-500 text-xs mt-1"}))),e.createElement("div",{className:"flex justify-end pt-4"},e.createElement("button",{type:"submit",disabled:x||a,className:"btn btn-primary flex items-center justify-center min-w-[120px]"},x?e.createElement(v,{size:"small"}):"Enregistrer")))))},U=()=>e.createElement("div",{className:"space-y-6"},e.createElement("div",null,e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},"Entrée de conteneur par client"),e.createElement("p",{className:"text-gray-600"},"Enregistrez les conteneurs entrant dans le parc par client")),e.createElement(A,null));export{U as default};
