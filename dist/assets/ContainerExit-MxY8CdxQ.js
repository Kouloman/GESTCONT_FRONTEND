import{r as o,R as e,L as N,d as b,e as m,m as g}from"./index-wFRW0Cer.js";import{F as f,c as y,a as v,b as l,E as c,d as i,e as D}from"./index.esm-DEY0XWA5.js";import{C as w}from"./check-Cvo7CuuM.js";import{S as F}from"./search-B_C1hulh.js";import"./index-Ch8__LMA.js";const k=y().shape({containerNumber:i().matches(/^[A-Z]{3}U\d{7}$/,"Format invalide. Ex: MSCU1234567").required("Le numéro de conteneur est requis")}),q=y().shape({exitDate:D().max(new Date,"La date ne peut pas être dans le futur").required("La date de sortie est requise"),booking:i().required("Le booking est requis"),vessel:i().required("Le navire est requis"),client:i().required("Le client est requis"),comments:i()}),I=()=>{const[t,n]=o.useState(null),[d,u]=o.useState(!1),[E,p]=o.useState(!1),[h,x]=o.useState(!1),S=async a=>{u(!0);try{try{const r=(await b.get(`/containers/number/${a.containerNumber}`)).data;if(r.status!=="IN_PARK"){m.error("Ce conteneur n'est pas dans le parc"),n(null);return}n(r)}catch{{const r=await g.getByContainerNumber(a.containerNumber);if(!r){m.error("Conteneur non trouvé"),n(null);return}if(r.status!=="IN_PARK"){m.error("Ce conteneur n'est pas dans le parc"),n(null);return}n(r)}}}catch{m.error("Erreur lors de la recherche du conteneur"),n(null)}finally{u(!1)}},C=async a=>{p(!0);try{const s={...a,exitDate:new Date(a.exitDate).toISOString()};try{await b.post(`/containers/${t.id}/exit`,s)}catch(r){if(r.isMockable)await g.exitContainer(t.containerNumber,s);else throw r}m.success("Sortie de conteneur enregistrée avec succès"),x(!0),n(null),setTimeout(()=>{x(!1)},3e3)}catch{m.error("Erreur lors de l'enregistrement de la sortie")}finally{p(!1)}};return e.createElement("div",{className:"bg-white rounded-lg shadow-sm p-6 animate-fadeIn"},e.createElement("h2",{className:"text-xl font-semibold text-gray-800 mb-6"},"Enregistrement de sortie de conteneur"),h&&e.createElement("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md text-green-800 flex items-center"},e.createElement(w,{size:20,className:"mr-2"}),e.createElement("span",null,"Sortie de conteneur enregistrée avec succès!")),e.createElement("div",{className:`mb-6 ${t?"opacity-50":""}`},e.createElement("h3",{className:"text-md font-medium text-gray-700 mb-3"},"Rechercher un conteneur"),e.createElement(f,{initialValues:{containerNumber:""},validationSchema:k,onSubmit:S,validateOnChange:!1},({isSubmitting:a})=>e.createElement(v,null,e.createElement("div",{className:"flex flex-col md:flex-row gap-3"},e.createElement("div",{className:"flex-grow"},e.createElement(l,{type:"text",id:"containerNumber",name:"containerNumber",placeholder:"Numéro de conteneur (ex: MSCU1234567)",className:"form-input uppercase",disabled:!!t}),e.createElement(c,{name:"containerNumber",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("button",{type:"submit",disabled:d||a||!!t,className:"btn btn-primary flex items-center justify-center min-w-[120px]"},d?e.createElement(N,{size:"small"}):e.createElement(e.Fragment,null,e.createElement(F,{size:16,className:"mr-2"}),"Rechercher")))))),t&&e.createElement("div",{className:"space-y-6 animate-fadeIn"},e.createElement("div",{className:"bg-gray-50 p-4 rounded-md"},e.createElement("h3",{className:"text-md font-medium text-gray-700 mb-3"},"Détails du conteneur"),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Numéro de conteneur"),e.createElement("p",{className:"font-medium"},t.containerNumber)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Armateur"),e.createElement("p",{className:"font-medium"},t.shippingLineName)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Code ISO"),e.createElement("p",{className:"font-medium"},t.isoCode)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Type"),e.createElement("p",{className:"font-medium"},t.type)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Date d'entrée"),e.createElement("p",{className:"font-medium"},new Date(t.entryDate).toLocaleDateString("fr-FR"))),t.damages&&e.createElement("div",{className:"md:col-span-2"},e.createElement("p",{className:"text-sm text-gray-500"},"Avaries"),e.createElement("p",{className:"font-medium"},t.damages)))),e.createElement("div",null,e.createElement("h3",{className:"text-md font-medium text-gray-700 mb-3"},"Informations de sortie"),e.createElement(f,{initialValues:{exitDate:new Date().toISOString().split("T")[0],booking:"",vessel:"",client:"",comments:""},validationSchema:q,onSubmit:C},({isSubmitting:a})=>e.createElement(v,{className:"space-y-4"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("label",{htmlFor:"exitDate",className:"form-label"},"Date de sortie"),e.createElement(l,{type:"date",id:"exitDate",name:"exitDate",className:"form-input"}),e.createElement(c,{name:"exitDate",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"booking",className:"form-label"},"Booking"),e.createElement(l,{type:"text",id:"booking",name:"booking",className:"form-input"}),e.createElement(c,{name:"booking",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"vessel",className:"form-label"},"Navire"),e.createElement(l,{type:"text",id:"vessel",name:"vessel",className:"form-input"}),e.createElement(c,{name:"vessel",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"client",className:"form-label"},"Client"),e.createElement(l,{type:"text",id:"client",name:"client",className:"form-input"}),e.createElement(c,{name:"client",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"comments",className:"form-label"},"Commentaires"),e.createElement(l,{as:"textarea",id:"comments",name:"comments",rows:2,className:"form-input"}),e.createElement(c,{name:"comments",component:"div",className:"text-red-500 text-xs mt-1"}))),e.createElement("div",{className:"flex justify-between pt-4"},e.createElement("button",{type:"button",onClick:()=>n(null),className:"btn btn-outline"},"Annuler"),e.createElement("button",{type:"submit",disabled:E||a,className:"btn btn-primary flex items-center justify-center min-w-[120px]"},E?e.createElement(N,{size:"small"}):"Enregistrer la sortie")))))))},M=()=>e.createElement("div",{className:"space-y-6"},e.createElement("div",null,e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},"Sortie de conteneur"),e.createElement("p",{className:"text-gray-600"},"Enregistrez les conteneurs sortant du parc par armateur")),e.createElement(I,null));export{M as default};
