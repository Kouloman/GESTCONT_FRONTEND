import{r as c,R as e,L as h,d as o,h as L,i as I,e as d,m as R}from"./index-wFRW0Cer.js";import{F,c as k,a as D,b as r,E as n,d as s,e as q}from"./index.esm-DEY0XWA5.js";import{C as w}from"./check-Cvo7CuuM.js";import"./index-Ch8__LMA.js";const O=k().shape({entryDate:q().max(new Date,"La date ne peut pas être dans le futur").required("La date d'entrée est requise"),shippingLineId:s().required("L'armateur est requis"),containerNumber:s().matches(/^[A-Z]{3}U\d{7}$/,"Format invalide. Ex: MSCU1234567").required("Le numéro de conteneur est requis"),isoCodeId:s().required("Le code ISO est requis"),type:s().oneOf(["DRY","REEFER"],"Type invalide").required("Le type de conteneur est requis"),damages:s(),transporter:s().required("Le transporteur est requis"),truckRef:s().required("La référence du camion est requise"),comments:s()}),A=()=>{const[p,u]=c.useState([]),[E,f]=c.useState([]),[y,v]=c.useState(!0),[g,x]=c.useState(!1),[S,N]=c.useState(!1);c.useEffect(()=>{(async()=>{try{const[t,a]=await Promise.all([o.get("/shipping-lines"),o.get("/iso-codes")]);u(t.data),f(a.data)}catch{try{const[a,i]=await Promise.all([L.getAll(),I.getAll()]);u(a),f(i)}catch{d.error("Erreur lors du chargement des données")}}finally{v(!1)}})()},[]);const C=async(m,{resetForm:t})=>{x(!0);try{const a={...m,entryDate:new Date(m.entryDate).toISOString()},i=p.find(l=>l.id===m.shippingLineId),b=E.find(l=>l.id===m.isoCodeId);i&&(a.shippingLineName=i.name),b&&(a.isoCode=b.code);try{await o.post("/containers",a)}catch(l){if(l.isMockable)await R.create(a);else throw l}d.success("Conteneur enregistré avec succès"),N(!0),t(),setTimeout(()=>{N(!1)},3e3)}catch{d.error("Erreur lors de l'enregistrement du conteneur")}finally{x(!1)}};return y?e.createElement(h,null):e.createElement("div",{className:"bg-white rounded-lg shadow-sm p-6 animate-fadeIn"},e.createElement("h2",{className:"text-xl font-semibold text-gray-800 mb-6"},"Enregistrement d'entrée de conteneur"),S&&e.createElement("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md text-green-800 flex items-center"},e.createElement(w,{size:20,className:"mr-2"}),e.createElement("span",null,"Conteneur enregistré avec succès!")),e.createElement(F,{initialValues:{entryDate:new Date().toISOString().split("T")[0],shippingLineId:"",containerNumber:"",isoCodeId:"",type:"",damages:"",transporter:"",truckRef:"",comments:""},validationSchema:O,onSubmit:C},({isSubmitting:m})=>e.createElement(D,{className:"space-y-4"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("label",{htmlFor:"entryDate",className:"form-label"},"Date d'entrée"),e.createElement(r,{type:"date",id:"entryDate",name:"entryDate",className:"form-input"}),e.createElement(n,{name:"entryDate",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"shippingLineId",className:"form-label"},"Armateur"),e.createElement(r,{as:"select",id:"shippingLineId",name:"shippingLineId",className:"form-select"},e.createElement("option",{value:""},"Sélectionner un armateur"),p.map(t=>e.createElement("option",{key:t.id,value:t.id},t.name))),e.createElement(n,{name:"shippingLineId",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"containerNumber",className:"form-label"},"Numéro de conteneur"),e.createElement(r,{type:"text",id:"containerNumber",name:"containerNumber",placeholder:"Ex: MSCU1234567",className:"form-input uppercase"}),e.createElement(n,{name:"containerNumber",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"isoCodeId",className:"form-label"},"Code ISO"),e.createElement(r,{as:"select",id:"isoCodeId",name:"isoCodeId",className:"form-select"},e.createElement("option",{value:""},"Sélectionner un code ISO"),E.map(t=>e.createElement("option",{key:t.id,value:t.id},t.code," - ",t.description))),e.createElement(n,{name:"isoCodeId",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"type",className:"form-label"},"Type de conteneur"),e.createElement(r,{as:"select",id:"type",name:"type",className:"form-select"},e.createElement("option",{value:""},"Sélectionner un type"),e.createElement("option",{value:"DRY"},"DRY"),e.createElement("option",{value:"REEFER"},"REEFER")),e.createElement(n,{name:"type",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"transporter",className:"form-label"},"Transporteur"),e.createElement(r,{type:"text",id:"transporter",name:"transporter",className:"form-input"}),e.createElement(n,{name:"transporter",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"truckRef",className:"form-label"},"Référence du camion"),e.createElement(r,{type:"text",id:"truckRef",name:"truckRef",className:"form-input"}),e.createElement(n,{name:"truckRef",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"damages",className:"form-label"},"Avaries"),e.createElement(r,{as:"textarea",id:"damages",name:"damages",rows:2,className:"form-input"}),e.createElement(n,{name:"damages",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"comments",className:"form-label"},"Commentaires"),e.createElement(r,{as:"textarea",id:"comments",name:"comments",rows:2,className:"form-input"}),e.createElement(n,{name:"comments",component:"div",className:"text-red-500 text-xs mt-1"}))),e.createElement("div",{className:"flex justify-end pt-4"},e.createElement("button",{type:"submit",disabled:g||m,className:"btn btn-primary flex items-center justify-center min-w-[120px]"},g?e.createElement(h,{size:"small"}):"Enregistrer")))))},U=()=>e.createElement("div",{className:"space-y-6"},e.createElement("div",null,e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},"Entrée de conteneur"),e.createElement("p",{className:"text-gray-600"},"Enregistrez les conteneurs entrant dans le parc par armateur")),e.createElement(A,null));export{U as default};
