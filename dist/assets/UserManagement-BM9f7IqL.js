import{c as j,r as c,d as x,k as E,e as m,R as e,L as w}from"./index-wFRW0Cer.js";import{F as z,c as M,a as $,b as y,E as f,f as P,d as o}from"./index.esm-DEY0XWA5.js";import{C as R}from"./check-Cvo7CuuM.js";import{X as D,S as I,T as O}from"./x-DcsFHoIM.js";import"./index-Ch8__LMA.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=j("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),B=M().shape({username:o().min(3,"Le nom d'utilisateur doit contenir au moins 3 caractères").required("Le nom d'utilisateur est requis"),email:o().email("Email invalide").required("L'email est requis"),password:o().min(6,"Le mot de passe doit contenir au moins 6 caractères").required("Le mot de passe est requis"),role:o().oneOf(["admin","user"],"Rôle invalide").required("Le rôle est requis"),permissions:P().of(o())}),G=["read:containers","create:containers","update:containers","delete:containers","read:shipping-lines","create:shipping-lines","update:shipping-lines","delete:shipping-lines","read:iso-codes","create:iso-codes","update:iso-codes","delete:iso-codes"],Q=()=>{const[n,i]=c.useState([]),[v,h]=c.useState(!0),[k,d]=c.useState(!1),[a,u]=c.useState(null),[N,b]=c.useState(!1),[S,g]=c.useState(null);c.useEffect(()=>{C()},[]);const C=async()=>{h(!0);try{try{const t=await x.get("/users");i(t.data)}catch{{const l=await E.getAll();i(l)}}}catch{m.error("Erreur lors du chargement des utilisateurs")}finally{h(!1)}},U=()=>{u(null),d(!0)},q=t=>{u(t),d(!0)},F=async t=>{try{try{await x.delete(`/users/${t}`)}catch(l){if(l.isMockable)await E.delete(t);else throw l}m.success("Utilisateur supprimé avec succès"),i(n.filter(l=>l.id!==t))}catch{m.error("Erreur lors de la suppression de l'utilisateur")}finally{g(null)}},L=async(t,{resetForm:l})=>{b(!0);try{if(a){try{const r=await x.put(`/users/${a.id}`,t);i(n.map(s=>s.id===a.id?r.data:s))}catch(r){if(r.isMockable){const s=await E.update(a.id,t);i(n.map(p=>p.id===a.id?s:p))}else throw r}m.success("Utilisateur mis à jour avec succès")}else{try{const r=await x.post("/users",t);i([...n,r.data])}catch(r){if(r.isMockable){const s=await E.create(t);i([...n,s])}else throw r}m.success("Utilisateur créé avec succès")}d(!1),u(null),l()}catch{m.error("Erreur lors de l'enregistrement de l'utilisateur")}finally{b(!1)}};return e.createElement("div",{className:"space-y-6"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",null,e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},"Gestion des utilisateurs"),e.createElement("p",{className:"text-gray-600"},"Créez et gérez les utilisateurs du système")),e.createElement("button",{onClick:U,className:"btn btn-primary flex items-center"},e.createElement(T,{size:18,className:"mr-2"}),"Nouvel utilisateur")),k&&e.createElement("div",{className:"bg-white rounded-lg shadow-sm p-6 animate-fadeIn"},e.createElement("h2",{className:"text-xl font-semibold text-gray-800 mb-6"},a?"Modifier l'utilisateur":"Nouvel utilisateur"),e.createElement(z,{initialValues:{username:(a==null?void 0:a.username)||"",email:(a==null?void 0:a.email)||"",password:"",role:(a==null?void 0:a.role)||"user",permissions:(a==null?void 0:a.permissions)||[]},validationSchema:B,onSubmit:L},({values:t,setFieldValue:l,isSubmitting:r})=>e.createElement($,{className:"space-y-4"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("label",{htmlFor:"username",className:"form-label"},"Nom d'utilisateur"),e.createElement(y,{type:"text",id:"username",name:"username",className:"form-input"}),e.createElement(f,{name:"username",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"email",className:"form-label"},"Email"),e.createElement(y,{type:"email",id:"email",name:"email",className:"form-input"}),e.createElement(f,{name:"email",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"password",className:"form-label"},a?"Nouveau mot de passe (laisser vide pour ne pas changer)":"Mot de passe"),e.createElement(y,{type:"password",id:"password",name:"password",className:"form-input",required:!a}),e.createElement(f,{name:"password",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",null,e.createElement("label",{htmlFor:"role",className:"form-label"},"Rôle"),e.createElement(y,{as:"select",id:"role",name:"role",className:"form-select"},e.createElement("option",{value:"user"},"Utilisateur"),e.createElement("option",{value:"admin"},"Administrateur")),e.createElement(f,{name:"role",component:"div",className:"text-red-500 text-xs mt-1"}))),t.role==="user"&&e.createElement("div",{className:"mt-4"},e.createElement("label",{className:"form-label"},"Autorisations"),e.createElement("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"},G.map(s=>e.createElement("div",{key:s,className:"flex items-center"},e.createElement("input",{type:"checkbox",id:`permission-${s}`,checked:t.permissions.includes(s),onChange:()=>{const p=t.permissions.includes(s)?t.permissions.filter(A=>A!==s):[...t.permissions,s];l("permissions",p)},className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.createElement("label",{htmlFor:`permission-${s}`,className:"ml-2 text-sm text-gray-700"},s))))),e.createElement("div",{className:"flex justify-end space-x-3 pt-4"},e.createElement("button",{type:"button",onClick:()=>{d(!1),u(null)},className:"btn btn-outline"},"Annuler"),e.createElement("button",{type:"submit",disabled:N||r,className:"btn btn-primary flex items-center justify-center min-w-[120px]"},N?e.createElement(w,{size:"small"}):"Enregistrer"))))),e.createElement("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden animate-fadeIn"},v?e.createElement("div",{className:"py-12 flex justify-center"},e.createElement(w,null)):e.createElement("table",{className:"min-w-full divide-y divide-gray-200"},e.createElement("thead",{className:"bg-gray-50"},e.createElement("tr",null,e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Nom d'utilisateur"),e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email"),e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Rôle"),e.createElement("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Autorisations"),e.createElement("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions"))),e.createElement("tbody",{className:"bg-white divide-y divide-gray-200"},n.length===0?e.createElement("tr",null,e.createElement("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500"},"Aucun utilisateur trouvé")):n.map(t=>e.createElement("tr",{key:t.id},e.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},e.createElement("div",{className:"text-sm font-medium text-gray-900"},t.username)),e.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},e.createElement("div",{className:"text-sm text-gray-500"},t.email)),e.createElement("td",{className:"px-6 py-4 whitespace-nowrap"},e.createElement("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.role==="admin"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`},t.role==="admin"?"Admin":"Utilisateur")),e.createElement("td",{className:"px-6 py-4"},t.role==="admin"?e.createElement("span",{className:"text-sm text-gray-500"},"Toutes les autorisations"):e.createElement("div",{className:"flex flex-wrap gap-1"},t.permissions&&t.permissions.length>0?t.permissions.slice(0,3).map((l,r)=>e.createElement("span",{key:r,className:"inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full"},l)):e.createElement("span",{className:"text-sm text-gray-500"},"Aucune"),t.permissions&&t.permissions.length>3&&e.createElement("span",{className:"inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full"},"+",t.permissions.length-3))),e.createElement("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},S===t.id?e.createElement("div",{className:"flex items-center justify-end space-x-2"},e.createElement("span",{className:"text-sm text-gray-600 mr-2"},"Confirmer?"),e.createElement("button",{onClick:()=>F(t.id),className:"text-red-600 hover:text-red-900 p-1"},e.createElement(R,{size:18})),e.createElement("button",{onClick:()=>g(null),className:"text-gray-600 hover:text-gray-900 p-1"},e.createElement(D,{size:18}))):e.createElement("div",{className:"flex items-center justify-end space-x-2"},e.createElement("button",{onClick:()=>q(t),className:"text-blue-600 hover:text-blue-900 p-1"},e.createElement(I,{size:18})),e.createElement("button",{onClick:()=>g(t.id),className:"text-red-600 hover:text-red-900 p-1"},e.createElement(O,{size:18}))))))))))};export{Q as default};
