import{r as c,R as e,L as x,d as N,e as m,m as b}from"./index-wFRW0Cer.js";import{F as g,c as y,a as f,b as l,E as i,d as h,e as D}from"./index.esm-DEY0XWA5.js";import{C as w}from"./check-Cvo7CuuM.js";import{S as F}from"./search-B_C1hulh.js";import"./index-Ch8__LMA.js";const I=y().shape({containerNumber:h().matches(/^[A-Z]{3}U\d{7}$/,"Format invalide. Ex: MSCU1234567").required("Le numéro de conteneur est requis")}),R=y().shape({exitDate:D().max(new Date,"La date ne peut pas être dans le futur").required("La date de sortie est requise"),comments:h()}),$=()=>{const[t,r]=c.useState(null),[o,d]=c.useState(!1),[u,p]=c.useState(!1),[S,E]=c.useState(!1),v=async n=>{d(!0);try{try{const a=(await N.get(`/containers/client/number/${n.containerNumber}`)).data;if(a.status!=="IN_PARK"){m.error("Ce conteneur n'est pas dans le parc"),r(null);return}r(a)}catch{{const a=await b.getByContainerNumber(n.containerNumber);if(!a){m.error("Conteneur non trouvé"),r(null);return}if(a.status!=="IN_PARK"||!a.client){m.error("Ce conteneur n'est pas dans le parc ou n'appartient pas à un client"),r(null);return}r(a)}}}catch{m.error("Erreur lors de la recherche du conteneur"),r(null)}finally{d(!1)}},C=async n=>{p(!0);try{const s={...n,exitDate:new Date(n.exitDate).toISOString()};try{await N.post(`/containers/client/${t.id}/exit`,s)}catch(a){if(a.isMockable)await b.exitContainerClient(t.containerNumber,s);else throw a}m.success("Sortie de conteneur enregistrée avec succès"),E(!0),r(null),setTimeout(()=>{E(!1)},3e3)}catch{m.error("Erreur lors de l'enregistrement de la sortie")}finally{p(!1)}};return e.createElement("div",{className:"bg-white rounded-lg shadow-sm p-6 animate-fadeIn"},e.createElement("h2",{className:"text-xl font-semibold text-gray-800 mb-6"},"Enregistrement de sortie de conteneur client"),S&&e.createElement("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-md text-green-800 flex items-center"},e.createElement(w,{size:20,className:"mr-2"}),e.createElement("span",null,"Sortie de conteneur enregistrée avec succès!")),e.createElement("div",{className:`mb-6 ${t?"opacity-50":""}`},e.createElement("h3",{className:"text-md font-medium text-gray-700 mb-3"},"Rechercher un conteneur client"),e.createElement(g,{initialValues:{containerNumber:""},validationSchema:I,onSubmit:v,validateOnChange:!1},({isSubmitting:n})=>e.createElement(f,null,e.createElement("div",{className:"flex flex-col md:flex-row gap-3"},e.createElement("div",{className:"flex-grow"},e.createElement(l,{type:"text",id:"containerNumber",name:"containerNumber",placeholder:"Numéro de conteneur (ex: MSCU1234567)",className:"form-input uppercase",disabled:!!t}),e.createElement(i,{name:"containerNumber",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("button",{type:"submit",disabled:o||n||!!t,className:"btn btn-primary flex items-center justify-center min-w-[120px]"},o?e.createElement(x,{size:"small"}):e.createElement(e.Fragment,null,e.createElement(F,{size:16,className:"mr-2"}),"Rechercher")))))),t&&e.createElement("div",{className:"space-y-6 animate-fadeIn"},e.createElement("div",{className:"bg-gray-50 p-4 rounded-md"},e.createElement("h3",{className:"text-md font-medium text-gray-700 mb-3"},"Détails du conteneur"),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Numéro de conteneur"),e.createElement("p",{className:"font-medium"},t.containerNumber)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Client"),e.createElement("p",{className:"font-medium"},t.client)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Code ISO"),e.createElement("p",{className:"font-medium"},t.isoCode)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Type"),e.createElement("p",{className:"font-medium"},t.type)),e.createElement("div",null,e.createElement("p",{className:"text-sm text-gray-500"},"Date d'entrée"),e.createElement("p",{className:"font-medium"},new Date(t.entryDate).toLocaleDateString("fr-FR"))),t.damages&&e.createElement("div",{className:"md:col-span-2"},e.createElement("p",{className:"text-sm text-gray-500"},"Avaries"),e.createElement("p",{className:"font-medium"},t.damages)))),e.createElement("div",null,e.createElement("h3",{className:"text-md font-medium text-gray-700 mb-3"},"Informations de sortie"),e.createElement(g,{initialValues:{exitDate:new Date().toISOString().split("T")[0],comments:""},validationSchema:R,onSubmit:C},({isSubmitting:n})=>e.createElement(f,{className:"space-y-4"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"},e.createElement("div",null,e.createElement("label",{htmlFor:"exitDate",className:"form-label"},"Date de sortie"),e.createElement(l,{type:"date",id:"exitDate",name:"exitDate",className:"form-input"}),e.createElement(i,{name:"exitDate",component:"div",className:"text-red-500 text-xs mt-1"})),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"comments",className:"form-label"},"Commentaires"),e.createElement(l,{as:"textarea",id:"comments",name:"comments",rows:2,className:"form-input"}),e.createElement(i,{name:"comments",component:"div",className:"text-red-500 text-xs mt-1"}))),e.createElement("div",{className:"flex justify-between pt-4"},e.createElement("button",{type:"button",onClick:()=>r(null),className:"btn btn-outline"},"Annuler"),e.createElement("button",{type:"submit",disabled:u||n,className:"btn btn-primary flex items-center justify-center min-w-[120px]"},u?e.createElement(x,{size:"small"}):"Enregistrer la sortie")))))))},M=()=>e.createElement("div",{className:"space-y-6"},e.createElement("div",null,e.createElement("h1",{className:"text-2xl font-bold text-gray-800"},"Sortie de conteneur par client"),e.createElement("p",{className:"text-gray-600"},"Enregistrez les conteneurs sortant du parc par client")),e.createElement($,null));export{M as default};
